use Web.HTTP, Collection;

class Test {
	function : Main(args : String[]) ~ Nil {
#~
		a := [
			[1., 9., 7.]
			[8., 1., 2.]];
		b := [
			[3., 2., 1., 5.]
			[5., 4., 7., 3.]
			[6., 9., 6., 8.]];
		System.ML.Matrix2D->DotProduct(a, b)->ToString();
		# "---"->PrintLine();

		a := [
			[1., 5.]
			[4., 8.]
			[7., 9.]];
		System.ML.Matrix2D->Transpose(a);
		# "---"->PrintLine();

	
		# linear regression

		m1 := [
			[1., 1., 10.]
			[1., 3., 14.]
			[1., 4., 15.]
			[1., 6., 18.]
			[1., 7., 20.]];
		m2 := [
			[9.]
			[10.]
			[13.]
			[14.]
			[16.]];
		m1_t := System.ML.Matrix2D->Transpose(m1);
		lhs := System.ML.Matrix2D->Inverse(System.ML.Matrix2D->DotProduct(m1_t, m1));
		rhs := System.ML.Matrix2D->DotProduct(m1_t, m2);
		System.ML.Matrix2D->DotProduct(lhs, rhs)->ToString()->PrintLine();
~#	

		# linear regression

		m1 := [
			[1., 1.]
			[1., 2.]
			[1., 3.]
			[1., 4.]
			[1., 5.]];
		m2 := [
			[2.]
			[4.]
			[5.]
			[4.]
			[5.]];

		m1_t := System.ML.Matrix2D->Transpose(m1);
		lhs := System.ML.Matrix2D->Inverse(System.ML.Matrix2D->DotProduct(m1_t, m1));
		rhs := System.ML.Matrix2D->DotProduct(m1_t, m2);
		coeffs := System.ML.Matrix2D->DotProduct(lhs, rhs);

		coeffs->ToString()->PrintLine();

		dims := coeffs->Size();
		rows := dims[0];
		cols := dims[1];

		total := 0.0;
		each(i : m2) {
			coeff := coeffs[i,0];
m2[i,0]->PrintLine();			
			if(i = 0) {
"0: {$coeff}"->PrintLine();				
				total += coeff;
			}
			else {
				foo := m2[i,0];
"1: {$total}, {$foo}"->PrintLine();								
				total += coeff * m2[i,0];
			};
		}
total->PrintLine();
		"---"->PrintLine();

		dims := m1->Size();
		rows := dims[0];
#		cols := dims[1];

		estimate_mean := System.ML.Matrix2D->AverageColumn(0, m2);
		estimates := Float->New[rows];
		each(i : rows) {
			estimate := m2[i,0] - estimate_mean;
			estimates[i] := estimate * estimate;
		}
		estimates->ToString()->PrintLine();

#~			
		m1_t := System.ML.Matrix2D->Transpose(m1);
		lhs := System.ML.Matrix2D->Inverse(System.ML.Matrix2D->DotProduct(m1_t, m1));
		rhs := System.ML.Matrix2D->DotProduct(m1_t, m2);
		System.ML.Matrix2D->DotProduct(lhs, rhs)->ToString()->PrintLine();	
~#		
	}
}