use Web.HTTP, Collection;

class Test {
	function : Main(args : String[]) ~ Nil {
#~
		a := [
			[1., 9., 7.]
			[8., 1., 2.]];
		b := [
			[3., 2., 1., 5.]
			[5., 4., 7., 3.]
			[6., 9., 6., 8.]];
		System.ML.Matrix2D->DotProduct(a, b)->ToString();
		# "---"->PrintLine();

		a := [
			[1., 5.]
			[4., 8.]
			[7., 9.]];
		System.ML.Matrix2D->Transpose(a);
		# "---"->PrintLine();

	
		# linear regression

		m1 := [
			[1., 1., 10.]
			[1., 3., 14.]
			[1., 4., 15.]
			[1., 6., 18.]
			[1., 7., 20.]];
		m2 := [
			[9.]
			[10.]
			[13.]
			[14.]
			[16.]];
		m1_trans := System.ML.Matrix2D->Transpose(m1);
		lhs_coeffs := System.ML.Matrix2D->Inverse(System.ML.Matrix2D->DotProduct(m1_trans, m1));
		rhs_coeffs := System.ML.Matrix2D->DotProduct(m1_trans, m2);
		System.ML.Matrix2D->DotProduct(lhs_coeffs, rhs_coeffs)->ToString()->PrintLine();
~#	

		# linear regression

		m1 := [
			[1., 1.]
			[1., 2.]
			[1., 3.]
			[1., 4.]
			[1., 5.]];
		m2 := [
			[2.]
			[4.]
			[5.]
			[4.]
			[5.]];

		m1_trans := System.ML.Matrix2D->Transpose(m1);
		lhs_coeffs := System.ML.Matrix2D->Inverse(System.ML.Matrix2D->DotProduct(m1_trans, m1));
		rhs_coeffs := System.ML.Matrix2D->DotProduct(m1_trans, m2);
		
		coeffs := System.ML.Matrix2D->DotProduct(lhs_coeffs, rhs_coeffs);
		dim := coeffs->Size();
		coeff_rows := dim[0];
#		coeff_cols := dim[1];

		dim := m1->Size();
		data_rows := dim[0];
#		data_cols := dim[1];


		data_avg := System.ML.Matrix2D->AverageColumn(0, m2);

		total_sum := 0.0;
		each(i : data_rows) {
			result := m2[i,0] - data_avg;
			total_sum += result * result;
		};
		total_sum->PrintLine();

		regress_sum := 0.0;
		each(i : data_rows) {
			term := 0.0;

			each(j : coeff_rows) {
				if(j = 0) {
					term += coeffs[j, 0];
				}
				else {
					term += (m1[i,1] * coeffs[j, 0]);
				}
				
			};
			result := term - data_avg;
			regress_sum += result * result;
		};
		
		r_sqrt := regress_sum / total_sum;
r_sqrt->PrintLine();

#		r_sqrt->PrintLine();
		"---"->PrintLine();
	}
}