use Collection.Generic;

class Test {
    function : Main(args : String[]) ~ Nil {
        encoding := "------WebKitFormBoundaryv6DIeo7UWlahIYi8\r\n";
        encoding += "Content-Disposition: form-data; name=\"fname\"\r\n\r\n";
        encoding += "Randy\"John\"&\\\r\n";
        encoding += "------WebKitFormBoundaryv6DIeo7UWlahIYi8\r\n";
        encoding += "Content-Disposition: form-data; name=\"lname\"\r\n\r\n";
        encoding += "Hollines /www/http/ @\r\n";
        encoding += "------WebKitFormBoundaryv6DIeo7UWlahIYi8--\r\n";

        lines := encoding->Lines();
        each(i : lines) {
            line := lines[i];
            "{$i}: |{$line}|"->PrintLine();
        };

        "---"->PrintLine();

        ParseMultipartEncoding(encoding);
    }

    function : ParseMultipartEncoding(encoding : String) ~ Map<String, String> {
        lines := encoding->Lines();
        if(lines->Size() > 0) {
            marker := lines[0];
            end_maker := marker + "--";

            each(i : lines) {
                line := lines[i];

                if(line->Equals(marker)) {
                    "marker: index={$i}"->PrintLine();
                }
                else if(line->StartsWith("Content-Disposition: form-data; name=\"")) {
                    "content marker: index={$i}"->PrintLine();
                }
                else if(line->StartsWith(end_maker)) {
                    "end-marker: index={$i}"->PrintLine();
                };
            };
        };

        return Nil;
    }

    function : ParseUrlEncoding(encoding : String) ~ Map<String, String> {
        decodings := Map->New()<String, String>;

        pairs :=  encoding->Split('&');
        if(pairs <> Nil) {
            each(i : pairs) {
                key_value := pairs[i]->Split('=');
                if(key_value <> Nil & key_value->Size() = 2) {
                    marker := Web.HTTP.Url->Decode(key_value[0])->ReplaceAll('+', ' ');
                    value := Web.HTTP.Url->Decode(key_value[1])->ReplaceAll('+', ' ');
                    decodings->Insert(marker, value);
                };
            };
        };

        return decodings;
    }
}