use Data.JSON.Stream;

class Test {
    function : Main(args : String[]) ~ Nil {
        input := "{  \"model\": \"llama3\",  \"prompt\": \"What is the longest road in Philadelphia that is not a highway?\" }"->ToByteArray();

        url := Web.HTTP.Url->New("http://localhost:11434/api/generate");
        data := Web.HTTP.HttpClient->QuickPost(url, input, "application/json");
        if(data <> Nil) {
            clob := data->GetContent()->ToString();

            clob->PrintLine();
            "---"->PrintLine();

            lines := clob->Split('\n');

            buffer := "";

            parser := Data.JSON.Stream.JsonStreamParser->New();
            each(line in lines) {
                parser->Reset(line);
                if(parser->GetNextElement("response") & parser->GetNextElement()) {
                  buffer += parser->GetValue();
                };
            };

            buffer->PrintLine();
        };
    }
}