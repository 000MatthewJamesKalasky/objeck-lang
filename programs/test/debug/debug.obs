class Foo {
	function : Main(args : String[]) ~ Nil {
		array := ['s', 'p','a','c','e'];

		b := Stringy->New(array);
		b->PrintLine();
		b->SubString(1,4)->PrintLine();
#		b->PrintLine();

		"---"->PrintLine();

		"space"->SubString(1,4)->PrintLine();
#~		
		b := Stringy->New();
		b->Append('H'); b->Append('e'); # b->Append('l'); b->Append('l'); b->Append('o'); b->Append('.');  b->Append('.'); 
		b->Get(0)->PrintLine();
		b->Get(1)->PrintLine();
		b->PrintLine();
#		b->Get(11)->PrintLine();
~#
	}
}

class Stringy {
	@string : Char[];
	@max : Int;
	@pos : Int;

	New() {
		@max := 4;
		@pos := 0;
		@string := Char->New[@max];
	}

	New(temp : Char[]) {
		@max := @pos := temp->Size();
		@string := Char->New[@max];

		Runtime->Copy(@string, 0, temp, 0, @max);
	}

	New(temp : Char[], offset : Int, length : Int) {
		space := offset + length; size := temp->Size();
		if(offset < 0 | offset > size | space < 0 | space > size) {
			@max := 4;
			@pos := 0;
			@string := Char->New[@max];
		}
		else {
			@string := Char->New[length];
			Runtime->Copy(@string, 0, temp, offset, length)->PrintLine();
			@max := @pos := length;
		};
	}
	
	method : Resize(amount : Int) ~ Nil {
		if(amount + @pos > @max) {
			max := @max * 2;
			temp := Char->New[max];
			Runtime->Copy(temp, 0, @string, 0, @max);

			@string := temp;
			@max := max;
		};
	}

	method : public : Append(char : Char) ~ Nil {
		Resize(1);

		@string[@pos] := char;
		@pos += 1;
	}

	method : public : SubString(length : Int) ~ Stringy {
		return SubString(0, length);
	}

	method : public : SubString(offset : Int, length : Int) ~ Stringy {
		return Stringy->New(@string, offset, length);
	}

	method : public : Delete(offset : Int, length : Int) ~ Bool {
		space := offset + length;
		if(offset < 0 | offset > @pos | space < 0 | space > @pos) {
			return false;
		};

		max := @max - length;
		temp := Char->New[max];
		Runtime->Copy(temp, 0, @string, 0, offset);
		Runtime->Copy(temp, offset, @string, space, @max - space);

		@string := temp;	
		@max := @pos := max;

		return true;
	}

	method : public : Get(index : Int) ~ Char {
		if(index < 0 | index >= @pos) {
			return '\0';
		};

		return @string[index];
	}

	method : public : PrintLine() ~ Nil {
		@string->PrintLine();
	}

	method : public : Print() ~ Nil {
		@string->Print();
	}
}