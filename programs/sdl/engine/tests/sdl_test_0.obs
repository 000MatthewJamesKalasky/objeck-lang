use SDL2;
use SDL2.Game;

class Test {
	function : Main(args : String[]) ~ Nil {
		SCREEN_WIDTH := 640;
		SCREEN_HEIGHT := 480;

		game := GameEngine->New(SCREEN_WIDTH, SCREEN_HEIGHT, "Engine Test");
		if(game->IsOk()) {
			e := game->GetEvent();
			
			bg := game->AddImageSprite("../../../../programs/sdl/engine/tests/media/images/hills.png");
			hero := game->AddAnimatedImageSprite("../../../../programs/sdl/engine/tests/media/images/walk.png", 6);

			bg_x := 0;
			bg_y := 0;

			hero_x := 60;
			hero_y := SCREEN_HEIGHT - (hero->GetHeight() + 20);

			frame := 0;
			hero_index := 0;

			quit := false;
			while(<>quit) {
				game->FrameStart();

				while(e->Poll() <> 0) {
					if(e->GetType() = EventType->SDL_QUIT) {
						quit := true;
					};
				};

				# call once per second
				frame += 1;
				if(frame >= game->GetFps() * 0.2) {
					frame := 0;
					hero_index += 1;
					
					bg_x -= bg->GetWidth() / 25;
					if(bg_x < -1 * bg->GetWidth()) {
						bg_x := 0;
					};

					if(hero_index >= hero->GetClipCount()) {
						hero_index := 0;
					};
				};

				game->Clear();
				bg->Render(bg_x, 0);
				bg->Render(bg_x + bg->GetWidth(), 0);
				hero->Render(hero_x, hero_y, hero_index);
				game->Show();

				game->FrameEnd();
			};
		};

		leaving {
			game->Quit();
		};
	}
}
