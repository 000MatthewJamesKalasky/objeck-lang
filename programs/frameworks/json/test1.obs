use Data.JSON.Stream;
use System.IO.Filesystem;

class Test {
	@buffer : static : Char[];
	@buffer_pos : static : Int;

	function : Main(args : String[]) ~ Nil {
		reader := FileReader->New(args[0]);
		
		c := GetNext(reader);
		while(c <> '\0') {
			c->PrintLine();
			c := GetNext(reader);
		};	
	}

	function : GetNext(reader : FileReader) ~ Char {
		if(@buffer = Nil | @buffer_pos >= @buffer->Size()) {
			@buffer_pos := 0;
			line := reader->ReadLine();
			if(line <> Nil) {
				@buffer := line->ToCharArray();
			}
			else {
				@buffer := Nil;
			};
		};
		
		if(@buffer <> Nil & @buffer_pos < @buffer->Size()) {
			char := @buffer[@buffer_pos++];
			while(@buffer_pos < @buffer->Size() & (char = ' ' | char = '\t' | char = '\r' | char = '\n')) {
				char := @buffer[@buffer_pos++];
			};

			return char;
		};

		reader->Close();
		return '\0';
	}
}