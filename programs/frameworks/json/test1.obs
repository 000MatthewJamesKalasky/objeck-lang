use Data.JSON.Stream;
use System.IO.Filesystem;

class StreamReader {
	@stream : InputStream;

	@buffer : Char[];
	@buffer_pos : Int;
	
	@is_eof : Bool;

	New(stream : InputStream) {
		@stream := stream;
	}

	method : public : NextChar() ~ Char {
		if(@buffer = Nil) {
			line := @stream->ReadLine();
			if(line = Nil) {
				@is_eof := true;
			}
			else {
line->Size()->PrintLine();				
				@buffer := line->ToCharArray();
			};
		};

		return ' ';
	}

	function : Main(args : String[]) ~ Nil {
		stream := StreamReader->New(FileReader->New(args[0]));
		stream->NextChar()->PrintLine();
		stream->NextChar()->PrintLine();
		stream->NextChar()->PrintLine();
		stream->NextChar()->PrintLine();
#~		
		count := 0;
		do {
			line := reader->ReadLine();
			if(line <> Nil) {
				line->Size()->PrintLine();
				if(line->Size() = 0) {
					"WTF: {$count}"->PrintLine();
					return;
				};
			};
			count += 1;
		}
		while(<>reader->IsEoF());
~#		
	}
}